

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Image pyramid tutorial &mdash; pyrtools 1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Steerable pyramids" href="tutorial3.html" />
    <link rel="prev" title="Basic examples using the tools in pyrtools" href="tutorial1.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> pyrtools
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="developerguide.html">Information for developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial1.html">Basic examples using the tools in pyrtools</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Image pyramid tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Content">Content</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Laplacian-Pyramids:">Laplacian Pyramids:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#PROJECTION-and-BASIS-functions:">PROJECTION and BASIS functions:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#QMF/WAVELET-PYRAMIDS.">QMF/WAVELET PYRAMIDS.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#FUNCTIONS-for-CONSTRUCTING/MANIPULATING-QMF/Wavelet-PYRAMIDS">FUNCTIONS for CONSTRUCTING/MANIPULATING QMF/Wavelet PYRAMIDS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#PERFECT-RECONSTRUCTION:-HAAR-AND-DEBAUCHIES-WAVELETS">PERFECT RECONSTRUCTION: HAAR AND DEBAUCHIES WAVELETS</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorial3.html">Steerable pyramids</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">pyrtools</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pyrtools</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Image pyramid tutorial</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/tutorial2.nblink.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 5ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Image-pyramid-tutorial">
<h1>Image pyramid tutorial<a class="headerlink" href="#Image-pyramid-tutorial" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Content">
<h2>Content<a class="headerlink" href="#Content" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Laplacian pyraids<ul>
<li>functions for constructing / manipulating Laplacian pyramids</li>
<li>aliasing in the Gaussian and Laplacian pyramids</li>
<li>Projection and Basis functions</li>
</ul>
</li>
<li>QMF/wavelet pyramids<ul>
<li>functions for constructing / manipulating QMF/Wavelet pyramids</li>
<li>perfect reconstruction: Haar and Daubechies wavelets</li>
<li>aliasing in wavelet transforms</li>
</ul>
</li>
</ul>
<p>A brief introduction to multi-scale pyramid decompositions for image processing. You should go through this, reading the comments, and executing the corresponding code. This file assumes a basic familiarity with matrix algebra, with linear systems and Fourier theory, and with Python. If you don’t understand a particular function call, execute <code class="docutils literal notranslate"><span class="pre">help(functionName)</span></code> to see documentation.</p>
<div class="line-block">
<div class="line">for basic tools see <code class="docutils literal notranslate"><span class="pre">TUTORIALS/01_tools.ipynb</span></code></div>
<div class="line">for multi-scale steerable pyramids see <code class="docutils literal notranslate"><span class="pre">TUTORIALS/03_steerable.ipynb</span></code></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">pyrtools</span> <span class="k">as</span> <span class="nn">pt</span>
<span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The autoreload extension is already loaded. To reload it, use:
  %reload_ext autoreload
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">im</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;../DATA/einsteinCorrect.pgm&#39;</span><span class="p">)</span>
<span class="c1"># im = pt.blurDn(im, 1, &#39;qmf9&#39;)</span>
<span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_2_0.png" src="_images/tutorial2_2_0.png" />
</div>
</div>
<div class="section" id="Laplacian-Pyramids:">
<h3>Laplacian Pyramids:<a class="headerlink" href="#Laplacian-Pyramids:" title="Permalink to this headline">¶</a></h3>
<p>Images may be decomposed into information at different scales.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Blurring eliminates the fine scales (detail):</span>
<span class="n">binom5</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">binomial_filter</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">lo_filt</span> <span class="o">=</span> <span class="n">binom5</span><span class="o">*</span><span class="n">binom5</span><span class="o">.</span><span class="n">T</span>
<span class="n">blurred</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">rconv2</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">lo_filt</span><span class="p">)</span> <span class="c1"># NOTE this convolution is a slow, see corrDn instead</span>
<span class="c1"># rconv2: Convolution of two matrices, with boundaries handled via reflection about the edge pixels.</span>

<span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">([</span><span class="n">im</span><span class="p">,</span> <span class="n">blurred</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;im&#39;</span><span class="p">,</span> <span class="s1">&#39;blurred&#39;</span><span class="p">]);</span>
<span class="c1"># help(pt.rconv2)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_4_0.png" src="_images/tutorial2_4_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># subtracting the blurred image from the original leaves ONLY the fine scale detail:</span>
<span class="n">fine0</span> <span class="o">=</span> <span class="n">im</span> <span class="o">-</span> <span class="n">blurred</span>
<span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">([</span><span class="n">fine0</span><span class="p">,</span> <span class="n">blurred</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;fine0&#39;</span><span class="p">,</span> <span class="s1">&#39;blurred&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_5_0.png" src="_images/tutorial2_5_0.png" />
</div>
</div>
<p>The blurred and fine images contain all the information found in the original image. Trivially, adding the blurred image to the fine scale detail will reconstruct the original. We can compare the original image to the sum of blurred and fine using the “image_stats” function, which reports on the statistics of the difference between it’s arguments:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># pt.imshow([im, blurred, fine0], title=None);</span>
<span class="n">pt</span><span class="o">.</span><span class="n">image_compare</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">blurred</span><span class="o">+</span><span class="n">fine0</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Difference statistics:
  Range: [0, 0]
  Mean: 0.000000,  Stdev (rmse): 0.000000,  SNR (dB): inf
</pre></div></div>
</div>
<p>Since the filter is a lowpass filter, we might want to <strong>subsample</strong> the blurred image. This may cause some aliasing (depends on the filter), but the decomposition structure given above will still be possible. The corrDn function correlates (same as convolution, but flipped filter) and downsamples in a single operation (for efficiency). The string ‘reflect1’ tells the function to handle boundaries by reflecting the image about the edge pixels. Notice that the blurred1 image is half the size
(in each dimension) of the original image.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">lo_filt</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">binom5</span><span class="o">*</span><span class="n">binom5</span><span class="o">.</span><span class="n">T</span>   <span class="c1"># construct a separable 2D filter</span>
<span class="n">blurred1</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">corrDn</span><span class="p">(</span><span class="n">image</span> <span class="o">=</span> <span class="n">im</span><span class="p">,</span> <span class="n">filt</span> <span class="o">=</span> <span class="n">lo_filt</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="c1">#corrDn: Compute correlation of matrices image with `filt, followed by downsampling.</span>

<span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">([</span><span class="n">fine0</span><span class="p">,</span> <span class="n">blurred1</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;fine0&#39;</span><span class="p">,</span> <span class="s1">&#39;blurred1&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_9_0.png" src="_images/tutorial2_9_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fine1</span> <span class="o">=</span> <span class="n">im</span> <span class="o">-</span> <span class="n">pt</span><span class="o">.</span><span class="n">upConv</span><span class="p">(</span><span class="n">image</span> <span class="o">=</span> <span class="n">blurred1</span><span class="p">,</span> <span class="n">filt</span> <span class="o">=</span> <span class="n">lo_filt</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="c1"># upConv: Upsample matrix image, followed by convolution with matrix filt.</span>
<span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">([</span><span class="n">fine1</span><span class="p">,</span> <span class="n">blurred1</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;fine1&#39;</span><span class="p">,</span> <span class="s1">&#39;blurred1&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_10_0.png" src="_images/tutorial2_10_0.png" />
</div>
</div>
<p>We now have a technique that takes an image, computes two new images (blurred1 and fine1) containing the coarse scale information and the fine scale information. We can also (trivially) reconstruct the original from these two (even if the subsampling of the blurred1 image caused aliasing):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">recon</span> <span class="o">=</span> <span class="n">fine1</span> <span class="o">+</span> <span class="n">pt</span><span class="o">.</span><span class="n">upConv</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">blurred1</span><span class="p">,</span> <span class="n">filt</span><span class="o">=</span><span class="n">lo_filt</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span><span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">stop</span><span class="o">=</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">))</span>
<span class="n">pt</span><span class="o">.</span><span class="n">image_compare</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">recon</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Difference statistics:
  Range: [0, 0]
  Mean: 0.000000,  Stdev (rmse): 0.000000,  SNR (dB): inf
</pre></div></div>
</div>
<p>Thus, we have described an INVERTIBLE linear transform that maps an input image to the two images blurred1 and fine1. The inverse transformation maps blurred1 and fine1 to the result. This is depicted graphically with a system diagram:</p>
<pre>
 (IM) --> blur/down2: (BLURRED1) -------> up2/blur -----> add --> (RECON)
  |                     |                                  ^
  |                     |                                  |
  |                     V                                  |
  |                  up2/blur                              |
  |                     |                                  |
  |                     |                                  |
  |                     V                                  |
   ---------------> subtract: (FINE1) ---------------------
</pre><p>Note that the number of samples in the representation (i.e., total samples in BLURRED1 and FINE1) is 1.5 times the number of samples in the original IM. Thus, this representation is OVERCOMPLETE.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">blurred2</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">corrDn</span><span class="p">(</span><span class="n">image</span> <span class="o">=</span> <span class="n">blurred1</span><span class="p">,</span> <span class="n">filt</span> <span class="o">=</span> <span class="n">lo_filt</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">blurred2</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_14_0.png" src="_images/tutorial2_14_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fine2</span> <span class="o">=</span> <span class="n">blurred1</span> <span class="o">-</span> <span class="n">pt</span><span class="o">.</span><span class="n">upConv</span><span class="p">(</span><span class="n">image</span> <span class="o">=</span> <span class="n">blurred2</span><span class="p">,</span> <span class="n">filt</span> <span class="o">=</span> <span class="n">lo_filt</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">fine2</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_15_0.png" src="_images/tutorial2_15_0.png" />
</div>
</div>
<p>Since blurred2 and fine2 can be used to reconstruct blurred1, and blurred1 and fine1 can be used to reconstruct the original image, the set of THREE images (also known as “subbands”) {blurred2, fine2, fine1} constitute a complete representation of the original image. Note that the three subbands are displayed at the same size, but they are actually three different sizes.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">([</span><span class="n">fine1</span><span class="p">,</span> <span class="n">fine2</span><span class="p">,</span> <span class="n">blurred2</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;fine1&#39;</span><span class="p">,</span> <span class="s1">&#39;fine2&#39;</span><span class="p">,</span> <span class="s1">&#39;blurred2&#39;</span><span class="p">],</span> <span class="n">col_wrap</span><span class="o">=</span><span class="mi">3</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_17_0.png" src="_images/tutorial2_17_0.png" />
</div>
</div>
<p>It is useful to consider exactly what information is stored in each of the pyramid subbands. The reconstruction process involves recursively interpolating these images and then adding them to the image at the next finer scale. To see the contribution of ONE of the representation images (say blurred2) to the reconstruction, we imagine filling all the other subbands with zeros and then following our reconstruction procedure. For the blurred2 subband, this is equivalent to simply calling upConv
twice:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">blurred2_tmp</span>  <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">upConv</span><span class="p">(</span><span class="n">image</span> <span class="o">=</span> <span class="n">blurred2</span><span class="p">,</span> <span class="n">filt</span> <span class="o">=</span> <span class="n">lo_filt</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">blurred2_full</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">upConv</span><span class="p">(</span><span class="n">image</span> <span class="o">=</span> <span class="n">blurred2_tmp</span><span class="p">,</span> <span class="n">filt</span> <span class="o">=</span> <span class="n">lo_filt</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">([</span><span class="n">fine1</span><span class="p">,</span> <span class="n">fine2</span><span class="p">,</span> <span class="n">blurred2_full</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;fine1&#39;</span><span class="p">,</span> <span class="s1">&#39;fine2&#39;</span><span class="p">,</span> <span class="s1">&#39;blurred2_full&#39;</span><span class="p">],</span> <span class="n">col_wrap</span><span class="o">=</span><span class="mi">3</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_19_0.png" src="_images/tutorial2_19_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># For the fine2 subband, this is equivalent to calling upConv once:</span>
<span class="n">fine2_full</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">upConv</span><span class="p">(</span><span class="n">image</span> <span class="o">=</span> <span class="n">fine2</span><span class="p">,</span> <span class="n">filt</span> <span class="o">=</span> <span class="n">lo_filt</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">([</span><span class="n">fine1</span><span class="p">,</span> <span class="n">fine2_full</span><span class="p">,</span> <span class="n">blurred2_full</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;fine1&#39;</span><span class="p">,</span> <span class="s1">&#39;fine2_full&#39;</span><span class="p">,</span> <span class="s1">&#39;blurred2_full&#39;</span><span class="p">],</span> <span class="n">col_wrap</span><span class="o">=</span><span class="mi">3</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_20_0.png" src="_images/tutorial2_20_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># If we did everything correctly, we should be able to add together</span>
<span class="c1"># these three full-size images to reconstruct the original image:</span>
<span class="n">recon</span> <span class="o">=</span> <span class="n">blurred2_full</span> <span class="o">+</span> <span class="n">fine2_full</span> <span class="o">+</span> <span class="n">fine1</span>
<span class="n">pt</span><span class="o">.</span><span class="n">image_compare</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">recon</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Difference statistics:
  Range: [0, 0]
  Mean: 0.000000,  Stdev (rmse): 0.000000,  SNR (dB): inf
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">([</span><span class="n">recon</span><span class="p">,</span> <span class="n">im</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_22_0.png" src="_images/tutorial2_22_0.png" />
</div>
</div>
<h2><p>FUNCTIONS for CONSTRUCTING/MANIPULATING LAPLACIAN PYRAMIDS</p>
</h2><p>We can continue this process, recursively splitting off finer and finer details from the blurred image (like peeling off the outer layers of an onion). The resulting data structure is known as a “Laplacian Pyramid”. To make things easier, we have written a function called Lpyr to construct this object. The function returns a long vector containing the subbands of the pyramid. The display routine showLpyr shows all the subbands of the pyramid, at their correct relative sizes. It should now be
clearer why these data structures are called “pyramids”.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pyr</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">pyramids</span><span class="o">.</span><span class="n">LaplacianPyramid</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
<span class="n">pt</span><span class="o">.</span><span class="n">pyrshow</span><span class="p">(</span><span class="n">pyr</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_24_0.png" src="_images/tutorial2_24_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># To access the coefficients of a single band, use: pyr.pyr_coeffs[(level, band)]</span>
<span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">pyr</span><span class="o">.</span><span class="n">pyr_coeffs</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_25_0.png" src="_images/tutorial2_25_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># The reconLpyr function allows you to reconstruct from a laplacian pyramid.</span>
<span class="c1"># The third (optional) arg allows you to select any subset of pyramid bands</span>
<span class="c1"># (default is to use ALL of them).</span>
<span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">pyr</span><span class="o">.</span><span class="n">recon_pyr</span><span class="p">(</span><span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]));</span>  <span class="c1"># reconstruct with just the first and third band</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_26_0.png" src="_images/tutorial2_26_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fullres</span> <span class="o">=</span> <span class="n">pyr</span><span class="o">.</span><span class="n">recon_pyr</span><span class="p">()</span>
<span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">fullres</span><span class="p">);</span>
<span class="n">pt</span><span class="o">.</span><span class="n">image_compare</span><span class="p">(</span><span class="n">im</span><span class="p">,</span><span class="n">fullres</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Difference statistics:
  Range: [0, 0]
  Mean: 0.000000,  Stdev (rmse): 0.000000,  SNR (dB): inf
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_27_1.png" src="_images/tutorial2_27_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># buildLpyr uses 5-tap filters by default for building Laplacian</span>
<span class="c1"># pyramids.  You can specify other filters:</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">named_filter</span><span class="p">(</span><span class="s1">&#39;binom3&#39;</span><span class="p">))</span>

<span class="n">pyr3</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">pyramids</span><span class="o">.</span><span class="n">LaplacianPyramid</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">downsample_filter_name</span><span class="o">=</span><span class="s1">&#39;binom3&#39;</span><span class="p">)</span>
<span class="n">pt</span><span class="o">.</span><span class="n">pyrshow</span><span class="p">(</span><span class="n">pyr3</span><span class="p">);</span>

<span class="n">fullres3</span> <span class="o">=</span> <span class="n">pyr3</span><span class="o">.</span><span class="n">recon_pyr</span><span class="p">(</span><span class="n">levels</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">upsample_filter_name</span><span class="o">=</span><span class="s1">&#39;binom3&#39;</span><span class="p">)</span>
<span class="n">pt</span><span class="o">.</span><span class="n">image_compare</span><span class="p">(</span><span class="n">im</span><span class="p">,</span><span class="n">fullres3</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[[0.35355339]
 [0.70710678]
 [0.35355339]]
Difference statistics:
  Range: [0, 0]
  Mean: 0.000000,  Stdev (rmse): 0.000000,  SNR (dB): inf
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_28_1.png" src="_images/tutorial2_28_1.png" />
</div>
</div>
<p>Here we build a “Laplacian” pyramid using <strong>random filters</strong>. filt1 is used with the downsampling operations and filt2 is used with the upsampling operations. We normalize the filters for display purposes. Of course, these filters are (almost certainly) not very “Gaussian”, and the subbands of such a pyramid will be garbage! Nevertheless, it is a simple property of the Laplacian pyramid that we can use ANY filters and we will still be able to reconstruct perfectly. <em>Indeed fine bands are
produced by subtracting the parent from blurred, so adding them back gives the parent back.</em></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">filt1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">,)</span>
<span class="n">filt1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">filt1</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">filt1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">filt1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">filt2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">,)</span>
<span class="n">filt2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">filt2</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">filt2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">filt2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_30_0.png" src="_images/tutorial2_30_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pyrr</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">pyramids</span><span class="o">.</span><span class="n">LaplacianPyramid</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">downsample_filter_name</span><span class="o">=</span><span class="n">filt1</span><span class="p">,</span> <span class="n">upsample_filter_name</span><span class="o">=</span><span class="n">filt2</span><span class="p">)</span>
<span class="n">pt</span><span class="o">.</span><span class="n">pyrshow</span><span class="p">(</span><span class="n">pyrr</span><span class="p">)</span>

<span class="n">fullresr</span> <span class="o">=</span> <span class="n">pyrr</span><span class="o">.</span><span class="n">recon_pyr</span><span class="p">(</span><span class="n">filt2</span><span class="p">)</span>

<span class="n">pt</span><span class="o">.</span><span class="n">image_compare</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">fullresr</span><span class="p">);</span>
<span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">([</span><span class="n">im</span><span class="p">,</span> <span class="n">fullresr</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Difference statistics:
  Range: [0, 0]
  Mean: -0.000000,  Stdev (rmse): 0.000000,  SNR (dB): 310.712589
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_31_1.png" src="_images/tutorial2_31_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_31_2.png" src="_images/tutorial2_31_2.png" />
</div>
</div>
<h2><p>ALIASING in the Gaussian and Laplacian pyramids:</p>
</h2><p>Unless one is careful, the subsampling operations will introduce aliasing artifacts in these pyramid transforms. This is true even though the Laplacian pyramid can be used to reconstruct the original image perfectly. When reconstructing, the pyramid is designed in such a way that these aliasing artifacts cancel out. So it’s not a problem if the only thing we want to do is reconstruct. However, it can be a serious problem if we intend to process each of the subbands independently.</p>
<p><p>One way to see the consequences of the aliasing artifacts is by examining variations that occur when the input is shifted. We choose an image and shift it by some number of pixels. Then blur (filter-downsample-upsample-filter) the original image and blur the shifted image. If there’s no aliasing, then the blur and shift operations should commute (i.e., shift-filter-downsample-upsample-filter is the same as filter-downsample-upsample-filter-shift). Try this for 2 different filters (by replacing
‘binom3’ with ‘binom5’ or ‘binom7’ below), and you’ll see that the aliasing is much worse for the 3 tap filter.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sig</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">sh</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>   <span class="c1"># shift amount</span>
<span class="n">lev</span> <span class="o">=</span> <span class="mi">2</span>      <span class="c1"># level of pyramid to look at</span>
<span class="c1">#filter to use:</span>
<span class="n">flt</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">named_filter</span><span class="p">(</span><span class="s1">&#39;binom3&#39;</span><span class="p">)</span>
<span class="c1"># flt = pt.named_filter(&#39;binom5&#39;)</span>
<span class="c1"># flt = pt.named_filter(&#39;binom7&#39;)</span>

<span class="n">shiftIm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span><span class="n">sh</span><span class="p">)</span>
<span class="n">pyr</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">pyramids</span><span class="o">.</span><span class="n">LaplacianPyramid</span><span class="p">(</span><span class="n">shiftIm</span><span class="p">,</span> <span class="n">lev</span><span class="p">,</span> <span class="n">flt</span><span class="p">,</span> <span class="n">flt</span><span class="p">,</span> <span class="s1">&#39;circular&#39;</span><span class="p">)</span>
<span class="n">shiftBlur</span> <span class="o">=</span> <span class="n">pyr</span><span class="o">.</span><span class="n">recon_pyr</span><span class="p">(</span><span class="n">flt</span><span class="p">,</span> <span class="s1">&#39;circular&#39;</span><span class="p">,</span> <span class="n">lev</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">pyr2</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">pyramids</span><span class="o">.</span><span class="n">LaplacianPyramid</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">lev</span><span class="p">,</span> <span class="n">flt</span><span class="p">,</span> <span class="n">flt</span><span class="p">,</span> <span class="s1">&#39;circular&#39;</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">pyr2</span><span class="o">.</span><span class="n">recon_pyr</span><span class="p">(</span><span class="n">flt</span><span class="p">,</span> <span class="s1">&#39;circular&#39;</span><span class="p">,</span> <span class="n">lev</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">blurShift</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="n">sh</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">blurShift</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">shiftBlur</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;blurShift&#39;</span><span class="p">,</span> <span class="s1">&#39;shiftBlur&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">pt</span><span class="o">.</span><span class="n">image_compare</span><span class="p">(</span><span class="n">blurShift</span><span class="p">,</span><span class="n">shiftBlur</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_33_0.png" src="_images/tutorial2_33_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Difference statistics:
  Range: [-33, 50]
  Mean: -0.000000,  Stdev (rmse): 24.973617,  SNR (dB): 1.431418
</pre></div></div>
</div>
</div>
<div class="section" id="PROJECTION-and-BASIS-functions:">
<h3>PROJECTION and BASIS functions:<a class="headerlink" href="#PROJECTION-and-BASIS-functions:" title="Permalink to this headline">¶</a></h3>
<div class="line-block">
<div class="line">An invertible, linear transform can be characterized in terms of a set of <strong>PROJECTION and BASIS functions</strong>.</div>
<div class="line">In python matrix notation:</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
<p>where x is an input, c are the transform coefficients, P and B are matrices. The columns of <span class="math notranslate nohighlight">\(P^T\)</span> are the projection functions (the input is projected onto the the columns of P to get each successive transform coefficient). The columns of B are the basis functions (x is a linear combination of the columns of B).</p>
<p>Since the Laplacian pyramid is a linear transform, we can ask: what are its BASIS functions? We consider these in one dimension for simplicity. The BASIS function corresponding to a given coefficient tells us how much that coefficient contributes to each pixel in the reconstructed image. We can construct a single basis function by setting one sample of one subband equal to 1.0 (and all others to zero) and reconstructing. To build the entire matrix, we have to do this for every sample of every
subband:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pyr</span><span class="o">.</span><span class="n">pyr_size</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>{(0, 0): (1, 16), (1, 0): (1, 8)}
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pyr</span><span class="o">.</span><span class="n">pyr_coeffs</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)][</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>-34.34149768777916
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sz</span> <span class="o">=</span> <span class="mi">36</span>
<span class="n">sig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">sz</span><span class="p">))</span>
<span class="n">pyr</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">pyramids</span><span class="o">.</span><span class="n">LaplacianPyramid</span><span class="p">(</span><span class="n">sig</span><span class="p">,)</span>

<span class="c1"># find size of basis</span>
<span class="n">Nelements</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">pyr</span><span class="o">.</span><span class="n">pyr_size</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
    <span class="n">Nelements</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="n">basis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">sz</span><span class="p">,</span> <span class="n">Nelements</span><span class="p">))</span>
<span class="n">ctr</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">pyr</span><span class="o">.</span><span class="n">pyr_coeffs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pyr</span><span class="o">.</span><span class="n">pyr_size</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">pyr</span><span class="o">.</span><span class="n">pyr_coeffs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">basis</span><span class="p">[:,</span><span class="n">ctr</span><span class="p">]</span> <span class="o">=</span> <span class="n">pyr</span><span class="o">.</span><span class="n">recon_pyr</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">ctr</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">pyr</span><span class="o">.</span><span class="n">pyr_coeffs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">basis</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_38_0.png" src="_images/tutorial2_38_0.png" />
</div>
</div>
<p><em>So the first pixel of the reconstructed image, out of the 36 pixels, receives constributions from the first, 37th, 38th, 55th, 56th, 64th and 65th dimensions of the pyramid representation.</em></p>
<p>The columns of the basis matrix are the basis functions. The matrix is short and fat, corresponding to the fact that the representation is <strong>OVERCOMPLETE</strong>. Below, we plot the middle one from each subband, starting with the finest scale. Note that all of these basis functions are lowpass (Gaussian-like) functions.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">locations</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">matlab_round</span><span class="p">(</span><span class="n">sz</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">3.</span><span class="o">/</span><span class="mf">2.</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">pyr</span><span class="o">.</span><span class="n">pyr_size</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))))</span>
<span class="c1"># locations, Nelements</span>

<span class="k">for</span> <span class="n">lev</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">locations</span><span class="p">)):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">lev</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">basis</span><span class="p">[:,</span> <span class="nb">int</span><span class="p">(</span><span class="n">locations</span><span class="p">[</span><span class="n">lev</span><span class="p">])])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_41_0.png" src="_images/tutorial2_41_0.png" />
</div>
</div>
<p>Now, we’d also like see the inverse (we’ll call them PROJECTION) functions. We need to ask <em>how much of each sample of the input image contributes to a given pyramid coefficient</em>. Thus, the matrix is constructed by building pyramids on the set of images with impulses at each possible location. The <strong>rows</strong> of this matrix are the projection functions.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">projection</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nelements</span><span class="p">,</span><span class="n">sz</span><span class="p">))</span>
<span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sz</span><span class="p">):</span>
    <span class="n">pyr</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">pyramids</span><span class="o">.</span><span class="n">LaplacianPyramid</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">synthetic_images</span><span class="o">.</span><span class="n">impulse</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">sz</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pos</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">proj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">pyr</span><span class="o">.</span><span class="n">pyr_coeffs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">proj</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">projection</span><span class="p">[:,</span><span class="n">pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">proj</span>
<span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">projection</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_43_0.png" src="_images/tutorial2_43_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Looking at successive rows of this matrix, we can visualize the subsampling operation.</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="c1"># Non-zero values are shifted by 1 position.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">projection</span><span class="p">[</span><span class="mi">18</span><span class="p">,:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">projection</span><span class="p">[</span><span class="mi">19</span><span class="p">,:])</span>
<span class="c1"># Non-zero values are shifted by 2 positions, rather than 1.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">projection</span><span class="p">[</span><span class="mi">45</span><span class="p">,:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">projection</span><span class="p">[</span><span class="mi">46</span><span class="p">,:])</span>
<span class="c1"># Non-zero values are shifted by 4 positions, rather than 1.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">projection</span><span class="p">[</span><span class="mi">58</span><span class="p">,:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">projection</span><span class="p">[</span><span class="mi">59</span><span class="p">,:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_44_0.png" src="_images/tutorial2_44_0.png" />
</div>
</div>
<p>Building a pyramid corresponds to multiplication by the projection matrix. Reconstructing from this pyramid corresponds to multiplication by the basis matrix. Thus, the product of the two matrices (in this order) should be the identity matrix:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">basis</span><span class="p">,</span> <span class="n">projection</span><span class="p">),</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_46_0.png" src="_images/tutorial2_46_0.png" />
</div>
</div>
<p>We can plot a few example projection functions at different scales. Note that all of the projection functions are bandpass functions, except for the coarsest subband which is lowpass.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">lev</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">locations</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">lev</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">projection</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">locations</span><span class="p">[</span><span class="n">lev</span><span class="p">])])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mean: &#39;</span> <span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">projection</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">locations</span><span class="p">[</span><span class="n">lev</span><span class="p">])]),</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="o">-.</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
mean:  -0.0
mean:  -0.0
mean:  -0.0
mean:  0.0786
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_48_1.png" src="_images/tutorial2_48_1.png" />
</div>
</div>
<p>Now consider the frequency response of these functions, plotted over the range [-pi,pi]:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">lev</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">locations</span><span class="p">)):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">lev</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">proj</span> <span class="o">=</span> <span class="n">projection</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">locations</span><span class="p">[</span><span class="n">lev</span><span class="p">])]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">32</span><span class="p">,</span><span class="mi">32</span><span class="p">))</span><span class="o">/</span><span class="mi">32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">proj</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="mi">64</span><span class="p">))))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_50_0.png" src="_images/tutorial2_50_0.png" />
</div>
</div>
<p>The first projection function is highpass, and the second is bandpass. Both of these look something like the Laplacian (2nd derivative) of a Gaussian. The last is lowpass, as are the basis functions. Thus, the basic operation used to create each level of the pyramid involves a simple highpass/lowpass split.</p>
</div>
<div class="section" id="QMF/WAVELET-PYRAMIDS.">
<h3>QMF/WAVELET PYRAMIDS.<a class="headerlink" href="#QMF/WAVELET-PYRAMIDS." title="Permalink to this headline">¶</a></h3>
<p>Two things about Laplacian pyramids are a bit unsatisfactory. First, there are more pixels (coefficients) in the representation than in the original image. Specifically, the 1-dimensional transform is overcomplete by a factor of 4/3, and the 2-dimensional transform is overcomplete by a factor of 2. Secondly, the “bandpass” images (fineN) do not segregate information according to orientation.</p>
<p>There are other varieties of pyramid. One type that arose in the speech coding community is based on a particular pairs of filters known as a “Quadrature Mirror Filters” or QMFs. These are closely related to Wavelets (essentially, they are approximate wavelet filters).</p>
<p>Recall that the Laplacian pyramid is formed by simple hi/low splitting at each level. The lowpass band is subsampled by a factor of 2, but the highpass band is NOT subsampled. In the QMF pyramid, we apply two filters (hi- and lo- pass) and subsample BOTH by a factor of 2, thus eliminating the excess coefficients of the Laplacian pyramid.</p>
<p>The two filters must have a specific relationship to each other. In particular, let n be an index for the filter samples. The highpass filter may be constructed from the lowpass filter by</p>
<ol class="arabic simple">
<li>modulating (multiplying) by (-1)^n (equivalent to shifting by pi in the Fourier domain)</li>
<li>flipping (i.e., reversing the order of the taps)</li>
<li>spatially shifting by one sample.</li>
</ol>
<p>Try to convince yourself that the resulting filters will always be orthogonal to each other (i.e., their inner products will be zero) when shifted by any multiple of two.</p>
<p>The function modulateFlip performs the first two of these operations. The third (spatial shifting) step is built into the convolution code.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">flo</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">named_filter</span><span class="p">(</span><span class="s1">&#39;qmf9&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="c1"># modulateFlip is a hidden method of the WaveletPyramid class</span>
<span class="n">fhi</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">pyramids</span><span class="o">.</span><span class="n">WaveletPyramid</span><span class="o">.</span><span class="n">_modulate_flip</span><span class="p">(</span><span class="n">flo</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">flo</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;lowpass&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fhi</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;highpass&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_54_0.png" src="_images/tutorial2_54_0.png" />
</div>
</div>
<p>In the Fourier domain, these filters are (approximately) “power-complementary”: the sum of their squared power spectra is (approximately) a constant. But note that neither is a perfect bandlimiter (i.e., a sinc function), and thus subsampling by a factor of 2 will cause aliasing in each of the subbands. See below for a discussion of the effect of this aliasing.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Plot the two frequency responses:</span>
<span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">32</span><span class="p">,</span><span class="mi">32</span><span class="p">))</span><span class="o">/</span><span class="mi">32</span>
<span class="n">flo_sp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">flo</span><span class="p">,</span><span class="mi">64</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">fhi_sp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">fhi</span><span class="p">,</span><span class="mi">64</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">flo_sp</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span>
         <span class="n">freq</span><span class="p">,</span> <span class="n">fhi_sp</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;FFT magnitudes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">flo_sp</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">fhi_sp</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Sum of squared magnitudes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_56_0.png" src="_images/tutorial2_56_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># We can split an input signal into two bands as follows:</span>
<span class="n">sig</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">synthetic_images</span><span class="o">.</span><span class="n">pink_noise</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">64</span><span class="p">),</span> <span class="mf">1.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sig</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;signal&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">lo1</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">corrDn</span><span class="p">(</span><span class="n">image</span> <span class="o">=</span> <span class="n">sig</span><span class="p">,</span> <span class="n">filt</span> <span class="o">=</span> <span class="n">flo</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="c1">#subsampling by a factor of 2 (step=2)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lo1</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">hi1</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">corrDn</span><span class="p">(</span><span class="n">image</span> <span class="o">=</span> <span class="n">sig</span><span class="p">,</span> <span class="n">filt</span> <span class="o">=</span> <span class="n">fhi</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="c1">#subsampling by a factor of 2 (step=2)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hi1</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;low band&#39;</span><span class="p">,</span><span class="s1">&#39;high band&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_57_0.png" src="_images/tutorial2_57_0.png" />
</div>
</div>
<div class="line-block">
<div class="line">Notice that the two subbands are half the size of the original image, due to the subsampling by a factor of 2.</div>
<div class="line"><em>One subtle point: the highpass and lowpass bands are subsampled on different lattices: the lowpass band retains the odd-numbered samples and the highpass band retains the even-numbered samples. This was the 1-sample shift relating the high and lowpass kernels (mentioned above).</em></div>
<div class="line">We’ve used the ‘reflect1’ to handle boundaries, which works properly for symmetric odd-length QMFs.</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># We can reconstruct the original image by interpolating these two subbands</span>
<span class="c1"># USING THE SAME FILTERS:</span>
<span class="n">reconlo</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">upConv</span><span class="p">(</span><span class="n">image</span> <span class="o">=</span> <span class="n">lo1</span><span class="p">,</span> <span class="n">filt</span> <span class="o">=</span> <span class="n">flo</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">reconhi</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">upConv</span><span class="p">(</span><span class="n">image</span> <span class="o">=</span> <span class="n">hi1</span><span class="p">,</span> <span class="n">filt</span> <span class="o">=</span> <span class="n">fhi</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sig</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">reconlo</span><span class="o">+</span><span class="n">reconhi</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">pt</span><span class="o">.</span><span class="n">image_compare</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="p">(</span><span class="n">reconlo</span><span class="o">+</span><span class="n">reconhi</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_59_0.png" src="_images/tutorial2_59_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Difference statistics:
  Range: [0, 0]
  Mean: 0.000080,  Stdev (rmse): 0.001188,  SNR (dB): 58.502314
</pre></div></div>
</div>
<p>We have described an <strong>INVERTIBLE</strong> linear transform that maps an input image to the two images lo1 and hi1. The inverse transformation maps these two images to the result. This is depicted graphically with a system diagram:</p>
<pre>
IM ---> flo/down2 --> LO1 --> up2/flo --> add --> RECON
    |                                      ^
    |                                     |
    |                                     |
     -> fhi/down2 --> HI1 --> up2/fhi -----
</pre><p>Note that the number of samples in the representation (i.e., total samples in LO1 and HI1) is equal to the number of samples in the original IM. Thus, this representation is exactly <strong>COMPLETE</strong>, or “critically sampled”.</p>
<p>So we’ve fixed one of the problems that we had with Laplacian pyramid. But the system diagram above places strong constraints on the filters. In particular, for these filters the reconstruction is no longer perfect. Turns out there are NO perfect-reconstruction symmetric filters that are power-complementary, except for the trivial case <code class="docutils literal notranslate"><span class="pre">[1]</span></code> and the nearly-trivial case <code class="docutils literal notranslate"><span class="pre">[1</span> <span class="pre">1]/sqrt(2)</span></code>.</p>
<p>Let’s consider the projection functions of this 2-band splitting operation. We can construct these by applying the transform to impulse input signals, for all possible impulse locations. The rows of the following matrix are the projection functions for each coefficient in the transform.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">pt</span><span class="o">.</span><span class="n">corrDn</span><span class="p">(</span><span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span> <span class="n">filt</span> <span class="o">=</span> <span class="n">flo</span><span class="p">,</span> <span class="n">edges</span> <span class="o">=</span> <span class="s1">&#39;circular&#39;</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
                    <span class="n">pt</span><span class="o">.</span><span class="n">corrDn</span><span class="p">(</span><span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span> <span class="n">filt</span> <span class="o">=</span> <span class="n">fhi</span><span class="p">,</span> <span class="n">edges</span> <span class="o">=</span> <span class="s1">&#39;circular&#39;</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                               <span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))))</span>
<span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">vrange</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;M&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_62_0.png" src="_images/tutorial2_62_0.png" />
</div>
</div>
<p>The transform matrix is composed of two sub-matrices. The top half contains the lowpass kernel, shifted by increments of 2 samples. The bottom half contains the highpass. Now we compute the inverse of this matrix:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">M_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
<span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">M_inv</span><span class="p">,</span> <span class="n">vrange</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;M_inv&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_64_0.png" src="_images/tutorial2_64_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># The inverse is (very close to) the transpose of the original</span>
<span class="c1"># matrix!  In other words, the transform is orthonormal.</span>

<span class="n">pt</span><span class="o">.</span><span class="n">image_compare</span><span class="p">(</span><span class="n">M_inv</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">M</span><span class="p">);</span>

<span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M_inv</span><span class="p">,</span><span class="n">M</span><span class="p">),</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">5</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Difference statistics:
  Range: [0, 0]
  Mean: -0.000004,  Stdev (rmse): 0.000263,  SNR (dB): 56.495757
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_65_1.png" src="_images/tutorial2_65_1.png" />
</div>
</div>
<div class="line-block">
<div class="line">This also points out a nice relationship between the corrDn and upConv functions, and the matrix representation:</div>
<div class="line">- <strong>corrDn</strong> is equivalent to multiplication by a matrix with copies of the filter on the <strong>ROWS</strong>, translated in multiples of the <strong>downsampling factor.</strong> - <strong>upConv</strong> is equivalent to multiplication by a matrix with copies of the filter on the <strong>COLUMNS</strong>, translated by the <strong>upsampling factor.</strong></div>
</div>
<blockquote>
<div><div class="line-block">
<div class="line">Multiplying the coefficient vector, which consists of concatenation of low pass and high pass coefficients, with the inverse (=transpose) matrix is the same as upsampling and convolving (i.e.&nbsp;UpConv) with the same decomposition filters. But WHY?</div>
<div class="line">This equivalency becomes clear by looking at the rows of the inverse matrix. A given row consists of subsampled shifted copies of low and high pass filters. When this is multiplied by the vector of coefficients, it is equivalent to upsampling the vector of coeffs (by inserting zeros) and convolving the first half (low pass) with low pass filter and the second half with the high pass filter and then sum them up. This makes sense, because in order to go back to the original signal, we need a
weightd sum of the low pass and high pass coeffs.</div>
</div>
</div></blockquote>
<p>As in the Laplacian pyramid, we can <strong>recursively</strong> apply this QMF band-splitting operation to the lowpass band:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">lo2</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">corrDn</span><span class="p">(</span><span class="n">image</span> <span class="o">=</span> <span class="n">lo1</span><span class="p">,</span> <span class="n">filt</span> <span class="o">=</span> <span class="n">flo</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">hi2</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">corrDn</span><span class="p">(</span><span class="n">image</span> <span class="o">=</span> <span class="n">lo1</span><span class="p">,</span> <span class="n">filt</span> <span class="o">=</span> <span class="n">fhi</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>The representation of the original signal is now comprised of the three subbands {hi1, hi2, lo2} (we don’t hold onto lo1, because it can be reconstructed from lo2 and hi2). Note that hi1 is at 1/2 resolution, and hi2 and lo2 are at 1/4 resolution: The total number of samples in these three subbands is thus equal to the number of samples in the original signal.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hi1</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;hi1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">hi1</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mf">1.1</span><span class="o">*</span><span class="n">hi1</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="mf">1.1</span><span class="o">*</span><span class="n">hi1</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hi2</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;hi2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="n">hi2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">1.1</span><span class="o">*</span><span class="n">hi2</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="mf">1.1</span><span class="o">*</span><span class="n">hi2</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lo2</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;lo2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="n">lo2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">1.1</span><span class="o">*</span><span class="n">lo2</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="mf">1.1</span><span class="o">*</span><span class="n">lo2</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sig</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;signal&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="n">sig</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">1.1</span><span class="o">*</span><span class="n">sig</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="mf">1.1</span><span class="o">*</span><span class="n">sig</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_71_0.png" src="_images/tutorial2_71_0.png" />
</div>
</div>
<p>Reconstruction proceeds as with the Laplacian pyramid: combine lo2 and hi2 to reconstruct lo1, which is then combined with hi1 to reconstruct the original signal:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">recon_lo1</span> <span class="o">=</span> <span class="p">(</span> <span class="n">pt</span><span class="o">.</span><span class="n">upConv</span><span class="p">(</span><span class="n">image</span> <span class="o">=</span> <span class="n">hi2</span><span class="p">,</span> <span class="n">filt</span> <span class="o">=</span> <span class="n">fhi</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span>
              <span class="n">pt</span><span class="o">.</span><span class="n">upConv</span><span class="p">(</span><span class="n">image</span> <span class="o">=</span> <span class="n">lo2</span><span class="p">,</span> <span class="n">filt</span> <span class="o">=</span> <span class="n">flo</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="p">)</span>
<span class="n">reconstructed</span> <span class="o">=</span> <span class="p">(</span> <span class="n">pt</span><span class="o">.</span><span class="n">upConv</span><span class="p">(</span><span class="n">image</span> <span class="o">=</span> <span class="n">hi1</span><span class="p">,</span> <span class="n">filt</span> <span class="o">=</span> <span class="n">fhi</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span>
                  <span class="n">pt</span><span class="o">.</span><span class="n">upConv</span><span class="p">(</span><span class="n">image</span> <span class="o">=</span> <span class="n">recon_lo1</span><span class="p">,</span> <span class="n">filt</span> <span class="o">=</span> <span class="n">flo</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="p">)</span>
<span class="n">pt</span><span class="o">.</span><span class="n">image_compare</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span><span class="n">reconstructed</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Difference statistics:
  Range: [0, 0]
  Mean: 0.000188,  Stdev (rmse): 0.001236,  SNR (dB): 58.158502
</pre></div></div>
</div>
</div>
<div class="section" id="FUNCTIONS-for-CONSTRUCTING/MANIPULATING-QMF/Wavelet-PYRAMIDS">
<h3>FUNCTIONS for CONSTRUCTING/MANIPULATING QMF/Wavelet PYRAMIDS<a class="headerlink" href="#FUNCTIONS-for-CONSTRUCTING/MANIPULATING-QMF/Wavelet-PYRAMIDS" title="Permalink to this headline">¶</a></h3>
<p>To make things easier, we have bundled these qmf operations and data structures into an object in Python.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># # If we feel like trying on another signal</span>
<span class="c1"># sig = pt.synthetic_images.pink_noise((1, 64), 1.5)</span>
<span class="c1"># plt.figure()</span>
<span class="c1"># plt.plot(sig.T)</span>
<span class="c1"># plt.show()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pyr</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">pyramids</span><span class="o">.</span><span class="n">WaveletPyramid</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">pyrshow</span><span class="p">(</span><span class="n">pyr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_76_0.png" src="_images/tutorial2_76_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># a different plot of the same thing</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pyr</span><span class="o">.</span><span class="n">pyr_coeffs</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">pyr</span><span class="o">.</span><span class="n">num_scales</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">pyr</span><span class="o">.</span><span class="n">pyr_size</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">pyr</span><span class="o">.</span><span class="n">pyr_size</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mf">1.5</span><span class="o">*</span><span class="nb">min</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">v</span><span class="p">)),</span> <span class="mf">1.5</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">v</span><span class="p">))])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_77_0.png" src="_images/tutorial2_77_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">res</span> <span class="o">=</span> <span class="n">pyr</span><span class="o">.</span><span class="n">recon_pyr</span><span class="p">()</span>
<span class="n">pt</span><span class="o">.</span><span class="n">image_compare</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Difference statistics:
  Range: [0, 0]
  Mean: 0.000202,  Stdev (rmse): 0.001873,  SNR (dB): 54.549345
</pre></div></div>
</div>
<p>Now for <strong>2D</strong>, we use <strong>separable</strong> filters. There are 4 ways to apply the two filters to the input image (followed by the relavent subsampling operation):</p>
<ol><li><p>lowpass in both x and y</p>
<li><p>lowpass in x and highpass in y</p>
<li><p>lowpass in y and highpass in x</p>
<li><p>highpass in both x and y.</p>
</ol><p>The pyramid is built by recursively subdividing the first of these bands into four new subbands.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># First, we&#39;ll take a look at some of the basis functions.</span>
<span class="n">sz</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">zim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">sz</span><span class="p">,</span><span class="n">sz</span><span class="p">))</span>
<span class="n">flo</span> <span class="o">=</span> <span class="s1">&#39;qmf9&#39;</span>
<span class="n">edges</span> <span class="o">=</span> <span class="s1">&#39;reflect1&#39;</span>
<span class="n">pyr</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">pyramids</span><span class="o">.</span><span class="n">WaveletPyramid</span><span class="p">(</span><span class="n">zim</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">### Put an  impulse into the middle of each band:</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">pyr</span><span class="o">.</span><span class="n">pyr_size</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span>
<span class="c1">#     print(lev, mid)</span>
    <span class="n">pyr</span><span class="o">.</span><span class="n">pyr_coeffs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">mid</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># And take a look at the reconstruction of each band:</span>
<span class="n">reconList</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">pyr</span><span class="o">.</span><span class="n">pyr_coeffs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">reconList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pyr</span><span class="o">.</span><span class="n">recon_pyr</span><span class="p">(</span><span class="n">flo</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">reconList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pyr</span><span class="o">.</span><span class="n">recon_pyr</span><span class="p">(</span><span class="n">flo</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
<span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">reconList</span><span class="p">,</span> <span class="n">vrange</span><span class="o">=</span><span class="s1">&#39;indep1&#39;</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">col_wrap</span><span class="o">=</span><span class="mi">3</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_82_0.png" src="_images/tutorial2_82_0.png" />
</div>
</div>
<p>Note that the first column contains horizontally oriented basis functions at different scales. The second contains vertically oriented basis functions. The third contains both diagonals (a checkerboard pattern). The bottom row shows a lowpass basis function.</p>
<p>Now look at the corresponding Fourier transform magnitudes (these are plotted over the frequency range [-pi, pi] ):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">freq</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">sz</span><span class="o">//</span><span class="mi">2</span><span class="p">,(</span><span class="n">sz</span><span class="o">//</span><span class="mi">2</span><span class="p">)))</span><span class="o">/</span><span class="n">sz</span>
<span class="n">imgList</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">pyr</span><span class="o">.</span><span class="n">pyr_coeffs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">basisFn</span> <span class="o">=</span> <span class="n">pyr</span><span class="o">.</span><span class="n">recon_pyr</span><span class="p">(</span><span class="n">flo</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">basisFn</span> <span class="o">=</span> <span class="n">pyr</span><span class="o">.</span><span class="n">recon_pyr</span><span class="p">(</span><span class="n">flo</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
    <span class="n">basisFmag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft2</span><span class="p">(</span><span class="n">basisFn</span><span class="p">,(</span><span class="n">sz</span><span class="p">,</span><span class="n">sz</span><span class="p">))))</span>
    <span class="n">imgList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">basisFmag</span><span class="p">)</span>

<span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">imgList</span><span class="p">,</span> <span class="n">vrange</span><span class="o">=</span><span class="s1">&#39;indep1&#39;</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">col_wrap</span><span class="o">=</span><span class="mi">3</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_84_0.png" src="_images/tutorial2_84_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># The filters at a given scale sum to a squarish annular region:</span>
<span class="n">sumSpectra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">sz</span><span class="p">,</span><span class="n">sz</span><span class="p">))</span>
<span class="n">lnum</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="k">for</span> <span class="n">bnum</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">basisFn</span> <span class="o">=</span> <span class="n">pyr</span><span class="o">.</span><span class="n">recon_pyr</span><span class="p">(</span><span class="n">flo</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="p">[</span><span class="n">lnum</span><span class="p">],</span> <span class="p">[</span><span class="n">bnum</span><span class="p">])</span>
    <span class="n">basisFmag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft2</span><span class="p">(</span><span class="n">basisFn</span><span class="p">,(</span><span class="n">sz</span><span class="p">,</span><span class="n">sz</span><span class="p">))))</span>
    <span class="n">sumSpectra</span> <span class="o">=</span> <span class="n">basisFmag</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">sumSpectra</span><span class="p">;</span>
<span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sumSpectra</span><span class="p">,</span> <span class="n">vrange</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;one scale&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_85_0.png" src="_images/tutorial2_85_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Now decompose an image:</span>
<span class="n">pyr</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">pyramids</span><span class="o">.</span><span class="n">WaveletPyramid</span><span class="p">(</span><span class="n">im</span><span class="o">/</span><span class="mi">255</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># View all of the subbands (except lowpass), scaled to be the same size</span>
<span class="c1"># (requires a big figure window):</span>
<span class="n">pt</span><span class="o">.</span><span class="n">pyrshow</span><span class="p">(</span><span class="n">pyr</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">2</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_87_0.png" src="_images/tutorial2_87_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># The recon_pyr function can be used to reconstruct the entire pyramid:</span>
<span class="n">reconstructed</span> <span class="o">=</span> <span class="n">pyr</span><span class="o">.</span><span class="n">recon_pyr</span><span class="p">()</span>
<span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">([</span><span class="n">im</span><span class="p">,</span><span class="n">reconstructed</span><span class="p">]);</span>
<span class="n">pt</span><span class="o">.</span><span class="n">image_compare</span><span class="p">(</span><span class="n">im</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span><span class="n">reconstructed</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Difference statistics:
  Range: [0, 0]
  Mean: -0.000763,  Stdev (rmse): 0.000334,  SNR (dB): 53.416318
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_88_1.png" src="_images/tutorial2_88_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># As with Laplacian pyramids, you can specify sub-levels and subbands</span>
<span class="c1"># to be included in the reconstruction.  For example:</span>
<span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">pyr</span><span class="o">.</span><span class="n">recon_pyr</span><span class="p">(</span><span class="s1">&#39;qmf9&#39;</span><span class="p">,</span> <span class="s1">&#39;reflect1&#39;</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">bands</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>  <span class="c1"># Horizontal only, all scales</span>
<span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">pyr</span><span class="o">.</span><span class="n">recon_pyr</span><span class="p">(</span><span class="s1">&#39;qmf9&#39;</span><span class="p">,</span> <span class="s1">&#39;reflect1&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]));</span>  <span class="c1"># two middle scales</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_89_0.png" src="_images/tutorial2_89_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_89_1.png" src="_images/tutorial2_89_1.png" />
</div>
</div>
</div>
<div class="section" id="PERFECT-RECONSTRUCTION:-HAAR-AND-DEBAUCHIES-WAVELETS">
<h3>PERFECT RECONSTRUCTION: HAAR AND DEBAUCHIES WAVELETS<a class="headerlink" href="#PERFECT-RECONSTRUCTION:-HAAR-AND-DEBAUCHIES-WAVELETS" title="Permalink to this headline">¶</a></h3>
<p>The symmetric QMF filters used above are not perfectly orthogonal. In fact, it’s impossible to construct a symmetric filter of size greater than 2 that is perfectly orthogonal to shifted copies (shifted by multiples of 2) of itself. For example, consider a symmetric kernel of length 3. Shift by two and the right end of the original kernel is aligned with the left end of the shifted one. Thus, the inner product of these two will be the square of the end tap, which will be non-zero.</p>
<p>However, one can easily create wavelet filters of length 2 that will do the job. This is the oldest known wavelet, known as the “Haar”. The two kernels are <code class="docutils literal notranslate"><span class="pre">[1,1]/sqrt(2)</span></code> and <code class="docutils literal notranslate"><span class="pre">[1,-1]/sqrt(2)</span></code>. These are trivially seen to be orthogonal to each other, and shifts by multiples of two are also trivially orthogonal. The projection functions of the Haar transform are in the rows of the following matrix, constructed by applying the transform to impulse input signals, for all possible impulse
locations:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">haarLo</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">named_filter</span><span class="p">(</span><span class="s1">&#39;haar&#39;</span><span class="p">)</span>
<span class="n">haarHi</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">pyramids</span><span class="o">.</span><span class="n">WaveletPyramid</span><span class="o">.</span><span class="n">_modulate_flip</span><span class="p">(</span><span class="n">haarLo</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">haarLo</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">haarLo</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;lowpass&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">haarHi</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;highpass&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_91_0.png" src="_images/tutorial2_91_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">pt</span><span class="o">.</span><span class="n">corrDn</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span> <span class="n">haarLo</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
                    <span class="n">pt</span><span class="o">.</span><span class="n">corrDn</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span> <span class="n">haarHi</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">M</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>   <span class="c1"># identity</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_92_0.png" src="_images/tutorial2_92_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_92_1.png" src="_images/tutorial2_92_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># As before, the filters are power-complementary (although the</span>
<span class="c1"># frequency isolation is rather poor, and thus the subbands will be</span>
<span class="c1"># heavily aliased):</span>
<span class="c1"># And the sum of the power spectra is again flat</span>

<span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">32</span><span class="p">,</span><span class="mi">32</span><span class="p">))</span><span class="o">/</span><span class="mi">32</span>
<span class="n">flo_sp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span> <span class="n">haarLo</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="mi">64</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">fhi_sp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span> <span class="n">haarHi</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="mi">64</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">flo_sp</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span>
         <span class="n">freq</span><span class="p">,</span> <span class="n">fhi_sp</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Fourier magnitudes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="n">flo_sp</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="n">fhi_sp</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;squared Fourier magnitudes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">flo_sp</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">fhi_sp</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Sum of squared Fourier magnitudes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_93_0.png" src="_images/tutorial2_93_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sig</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">synthetic_images</span><span class="o">.</span><span class="n">pink_noise</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">64</span><span class="p">),</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">pyr</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">pyramids</span><span class="o">.</span><span class="n">WaveletPyramid</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;haar&#39;</span><span class="p">,</span> <span class="s1">&#39;reflect1&#39;</span><span class="p">)</span>

<span class="n">pt</span><span class="o">.</span><span class="n">pyrshow</span><span class="p">(</span><span class="n">pyr</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_94_0.png" src="_images/tutorial2_94_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># check perfect reconstruction:</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">pyr</span><span class="o">.</span><span class="n">recon_pyr</span><span class="p">(</span><span class="s1">&#39;haar&#39;</span><span class="p">,</span> <span class="s1">&#39;reflect1&#39;</span><span class="p">)</span>
<span class="n">pt</span><span class="o">.</span><span class="n">image_compare</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span><span class="n">res</span><span class="p">);</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sig</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Difference statistics:
  Range: [0, 0]
  Mean: 0.000000,  Stdev (rmse): 0.000000,  SNR (dB): 298.814256
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_95_1.png" src="_images/tutorial2_95_1.png" />
</div>
</div>
<p>If you want perfect reconstruction, but don’t like the Haar transform, there’s another option: drop the symmetry requirement. Ingrid Daubechies developed one of the earliest sets of such perfect-reconstruction wavelets. The simplest of these is of length 4:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[62]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">daub_lo</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">named_filter</span><span class="p">(</span><span class="s1">&#39;daub2&#39;</span><span class="p">)</span>
<span class="n">daub_hi</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">pyramids</span><span class="o">.</span><span class="n">WaveletPyramid</span><span class="o">.</span><span class="n">_modulate_flip</span><span class="p">(</span><span class="n">daub_lo</span><span class="p">)</span>
<span class="c1"># The daub_lo filter is constructed to be orthogonal to 2 shifted</span>
<span class="c1"># copy of itself.  For example:</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">daub_lo</span><span class="p">,[[</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">]]))</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([[</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">]],</span><span class="n">daub_lo</span><span class="p">))))</span>

<span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">pt</span><span class="o">.</span><span class="n">corrDn</span><span class="p">(</span><span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span> <span class="n">filt</span> <span class="o">=</span> <span class="n">daub_lo</span><span class="p">,</span> <span class="n">edges</span> <span class="o">=</span> <span class="s1">&#39;circular&#39;</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
                    <span class="n">pt</span><span class="o">.</span><span class="n">corrDn</span><span class="p">(</span><span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span> <span class="n">filt</span> <span class="o">=</span> <span class="n">daub_hi</span><span class="p">,</span> <span class="n">edges</span> <span class="o">=</span> <span class="s1">&#39;circular&#39;</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))))</span>
<span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">pt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">M</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[[2.90920066e-13]]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_97_1.png" src="_images/tutorial2_97_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_97_2.png" src="_images/tutorial2_97_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[63]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[63]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;StemContainer object of 3 artists&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_98_1.png" src="_images/tutorial2_98_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[64]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Again, they&#39;re power complementary and sum of the power spectra is flat</span>

<span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">32</span><span class="p">,</span><span class="mi">32</span><span class="p">))</span><span class="o">/</span><span class="mi">32</span>
<span class="n">flo_sp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">daub_lo</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="mi">64</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">fhi_sp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">daub_hi</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="mi">64</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">flo_sp</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span>
         <span class="n">freq</span><span class="p">,</span> <span class="n">fhi_sp</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Fourier magnitudes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="n">flo_sp</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="n">fhi_sp</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;squared Fourier magnitudes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">flo_sp</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">fhi_sp</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Sum of squared Fourier magnitudes&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_99_0.png" src="_images/tutorial2_99_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[65]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Make a pyramid using the same code as before (except that we can&#39;t</span>
<span class="c1"># use reflected boundaries with asymmetric filters):</span>
<span class="n">pyr</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">pyramids</span><span class="o">.</span><span class="n">WaveletPyramid</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">filter_name</span><span class="o">=</span><span class="n">daub_lo</span><span class="p">,</span> <span class="n">edge_type</span><span class="o">=</span><span class="s1">&#39;circular&#39;</span><span class="p">)</span>

<span class="n">pt</span><span class="o">.</span><span class="n">pyrshow</span><span class="p">(</span><span class="n">pyr</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">2</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_100_0.png" src="_images/tutorial2_100_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[66]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">res</span> <span class="o">=</span> <span class="n">pyr</span><span class="o">.</span><span class="n">recon_pyr</span><span class="p">(</span><span class="n">daub_lo</span><span class="p">,</span><span class="s1">&#39;circular&#39;</span><span class="p">)</span>
<span class="n">pt</span><span class="o">.</span><span class="n">image_compare</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span><span class="n">res</span><span class="p">);</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sig</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Difference statistics:
  Range: [0, 0]
  Mean: -0.000000,  Stdev (rmse): 0.000000,  SNR (dB): 228.209585
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_101_1.png" src="_images/tutorial2_101_1.png" />
</div>
</div>
<h2><p>ALIASING IN WAVELET TRANSFORMS</p>
</h2><p><strong>aka. what’s wrong with wavelets</strong></p>
<p>All of these orthonormal pyramid/wavelet transforms have a lot of aliasing in the subbands. You can see that in the frequency response plots since the frequency response of each filter covers well more than half the frequency domain. The aliasing can have serious consequences…</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[67]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Get one of the basis functions of the 2D Daubechies wavelet transform:</span>
<span class="n">filt</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">named_filter</span><span class="p">(</span><span class="s1">&#39;daub4&#39;</span><span class="p">)</span>
<span class="c1"># filt = pt.named_filter(&#39;qmf13&#39;)</span>
<span class="n">pyr</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">pyramids</span><span class="o">.</span><span class="n">WaveletPyramid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">64</span><span class="p">)),</span><span class="mi">3</span><span class="p">,</span><span class="n">filt</span><span class="p">,</span><span class="s1">&#39;circular&#39;</span><span class="p">)</span>
<span class="n">lev</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">pyr</span><span class="o">.</span><span class="n">pyr_size</span><span class="p">[(</span><span class="n">lev</span><span class="p">,</span> <span class="mi">0</span><span class="p">)][</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)))</span>
<span class="n">pyr</span><span class="o">.</span><span class="n">pyr_coeffs</span><span class="p">[(</span><span class="n">lev</span><span class="p">,</span> <span class="mi">0</span><span class="p">)][</span><span class="n">mid</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">sig</span> <span class="o">=</span> <span class="n">pyr</span><span class="o">.</span><span class="n">recon_pyr</span><span class="p">(</span><span class="n">filt</span><span class="p">,</span><span class="s1">&#39;circular&#39;</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">sig</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_103_0.png" src="_images/tutorial2_103_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[68]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Since the basis functions are orthonormal, building a pyramid using this</span>
<span class="c1"># input will yield a single non-zero coefficient.</span>
<span class="n">pyr</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">pyramids</span><span class="o">.</span><span class="n">WaveletPyramid</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">filt</span><span class="p">,</span> <span class="s1">&#39;circular&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pyr</span><span class="o">.</span><span class="n">pyr_coeffs</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">pyr</span><span class="o">.</span><span class="n">num_scales</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">pyr</span><span class="o">.</span><span class="n">pyr_size</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">pyr</span><span class="o">.</span><span class="n">pyr_size</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="o">-.</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_104_0.png" src="_images/tutorial2_104_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[70]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Now shift the input by one sample and re-build the pyramid.</span>
<span class="n">shifted_sig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">spyr</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">pyramids</span><span class="o">.</span><span class="n">WaveletPyramid</span><span class="p">(</span><span class="n">shifted_sig</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">filt</span><span class="p">,</span> <span class="s1">&#39;circular&#39;</span><span class="p">)</span>

<span class="c1"># Plot each band of the unshifted and shifted decomposition</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">spyr</span><span class="o">.</span><span class="n">pyr_coeffs</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">spyr</span><span class="o">.</span><span class="n">num_scales</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">spyr</span><span class="o">.</span><span class="n">pyr_size</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">spyr</span><span class="o">.</span><span class="n">pyr_size</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="o">-.</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/tutorial2_105_0.png" src="_images/tutorial2_105_0.png" />
</div>
</div>
<p>In the third band, we expected the coefficients to move around because the signal was shifted. But notice that in the original signal decomposition, the other bands were filled with zeros. After the shift, they have significant content. Although these subbands are supposed to represent information at different scales, their content also depends on the relative POSITION of the input signal.</p>
<p>This problem is not unique to the Daubechies transform. The same is true for the QMF transform. Try it… In fact, the same kind of problem occurs for almost any orthogonal pyramid transform (the only exception is the limiting case in which the filter is a sinc function).</p>
<p><strong>Orthogonal pyramid transforms are not shift-invariant.</strong> Although orthogonality may be an important property for some applications (e.g., data compression), orthogonal pyramid transforms are generally not so good for image analysis.</p>
<p>The overcompleteness of the Laplacian pyramid turns out to be a good thing in the end. By using an overcomplete representation (and by choosing the filters properly to avoid aliasing as much as possible), you end up with a representation that is useful for image analysis.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tutorial3.html" class="btn btn-neutral float-right" title="Steerable pyramids" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tutorial1.html" class="btn btn-neutral float-left" title="Basic examples using the tools in pyrtools" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Eero Simoncelli, Rob Young, William Broderick, Pierre-Étienne Fiquet, Zhuo Wang, Zahra Kadkhodaie, Nikhil Parthasarathy

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>